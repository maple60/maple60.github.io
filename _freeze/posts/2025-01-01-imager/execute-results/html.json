{
  "hash": "f137b24fe49e85607cb46201e41980bc",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"画像処理のためのRパッケージimagerの使い方\"\ndescription: \"imagerパッケージについての基本的な使い方の紹介です\"\ndate: \"2026-01-01\"\ndate-modified: \"2026-01-01\"\ndraft: false\ncategories: [r]\n---\n\n# 概要\n\nRで画像解析をしたいとなったときに、`{imager}`というパッケージがあることを知った。\nいろいろと試した結果を記す。\n\n# パッケージの読み込み\n\nインストールは普通に`install.packages()`でOK。\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"imager\")\n```\n:::\n\n\n読み込みは以下のようにする。\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(\"imager\")\n```\n:::\n\n\n# 画像の読み込みと表示\n\n画像の読み込みには`load.image()`を使う。\nサンプル画像が5枚(動画が1つ)用意されている。\nサンプルの確認は以下のようにする。\n\n::: {.cell}\n\n```{.r .cell-code}\nlist.files(system.file('extdata', package = 'imager'))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"coins.png\"           \"HubbleDeepField.jpg\" \"Leonardo_Birds.jpg\" \n[4] \"parrots.png\"         \"tennis_sif.mp4\"     \n```\n\n\n:::\n:::\n\n\nボートのサンプル画像もあるのだが、ここには保存されていないようだ。\n\nちなみに、`system.file()`は、指定したパッケージがパソコンのどこに保存されているかを返す関数らしい。`package='imager`でパッケージを指定して、第1引数の`extdata`でextra dataの保存場所を指定する。\n\n今回はオウムのサンプル画像を読み込み、それを表示させる。\n表示は通常の`plot()`でOK。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfile <- system.file('extdata/parrots.png', package = 'imager')\nimg <- load.image(file)\nplot(img)\n```\n\n::: {.cell-output-display}\n![](2025-01-01-imager_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n複数枚の画像をまとめて読み込むには、`load.dir()`を使う。\n\n::: {.cell}\n\n```{.r .cell-code}\ndir <- system.file('extdata/', package = 'imager')\nlist_img <- load.dir(dir)\nplot(list_img)\n```\n\n::: {.cell-output-display}\n![](2025-01-01-imager_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nサンプルではなく、自分の画像を表示させるときは、適切なパスを指定すればちゃんと読み込める。\n`load.dir()`の場合も同様。\n\n```r\nfile <- \"/imagefile/hoge.jpg\"\nimg <- load.image(file)\n```\n\nまた、サンプルを読み込むときは、専用の関数がある。\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# sketch of birds by Leonardo, from Wikimedia\nplot(load.example(\"birds\"))\n```\n\n::: {.cell-output-display}\n![](2025-01-01-imager_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Parotts from Kodak\nplot(load.example(\"parrots\"))\n```\n\n::: {.cell-output-display}\n![](2025-01-01-imager_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n\n```{.r .cell-code}\n# The \"coins\" image comes from scikit-image.\nplot(load.example(\"coins\"))\n```\n\n::: {.cell-output-display}\n![](2025-01-01-imager_files/figure-html/unnamed-chunk-6-3.png){width=672}\n:::\n\n```{.r .cell-code}\n# The Hubble Deep field (hubble) is from Wikimedia.\nplot(load.example(\"hubble\"))\n```\n\n::: {.cell-output-display}\n![](2025-01-01-imager_files/figure-html/unnamed-chunk-6-4.png){width=672}\n:::\n\n```{.r .cell-code}\n# Boats from Kodak\nplot(boats)\n```\n\n::: {.cell-output-display}\n![](2025-01-01-imager_files/figure-html/unnamed-chunk-6-5.png){width=672}\n:::\n:::\n\n\nボートだけはそのまま読み込める。\nなにか適当に試したいときはboatsが便利。\n\n# 画像の情報確認\n\n画像はcimgという形式で保存される。\nコンソールにそのままオブジェクトを入力すると、基本情報が出力される。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nboats\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nImage. Width: 256 pix Height: 384 pix Depth: 1 Colour channels: 3 \n```\n\n\n:::\n:::\n\n\n`boats`は通常の画像形式で、幅256ピクセル、高さ384ピクセル、深さ1、チャンネル数が3となる。\n\nここで、深さはフレームのことであり、動画の場合は画像が連続するため、深さがフレーム数ということになる。\n\nチャンネル数は色付き画像ならRGBの3になり、グレースケールなら1チャンネルとなる。\n\n# グレースケール変換\n\nグレースケール変換は`grayscale()`で簡単にできる。\n\n第2引数に`method`がある。\nデフォルトは`\"Luma\"`となっており、この場合は輝度の線形近似によりグレースケール変換をおこなう。\n他には`\"XYZ\"`をとることができるが、この場合は画像がsRGB色空間にあると想定され、CIE輝度 CIE luminanceが使われるとのこと。\n特にこだわりがなければ、省略する。\n\n意外と大事になるのが第3引数。\n`drop=TRUE`となっている。\n`TRUE`の場合は画像が1チャンネルで出力される。\n`FALSE`の場合は3チャンネルが保持されたままグレースケールに変換される。\nあとで色をつけたいときは`FALSE`にしておくと良いかもしれない。\n基本的にはデフォルトのままにしておくと良いと思う。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nimg_gray <- grayscale(boats)\nlayout(matrix(c(1, 2), 1, 2, byrow = TRUE))\nplot(boats, main = \"Original\")\nplot(img_gray, main = \"Grayscale\")\n```\n\n::: {.cell-output-display}\n![](2025-01-01-imager_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n",
    "supporting": [
      "2025-01-01-imager_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}